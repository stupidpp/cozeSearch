<!-- ËøôÊòØÊ≠£Á°ÆÁöÑ‰ª£Á†ÅÔºåËØ∑Áõ¥Êé•ÊõøÊç¢ -->
<view class="professor-list" wx:if="{{candidates && candidates.length}}">
  <block wx:for="{{candidates}}" wx:for-item="prof" wx:for-index="idx" wx:key="uniqueKey">
    <view class="prof-card {{prof.displayScore < 30 ? 'low-match' : ''}}">
      <!-- Âè≥‰∏äËßíÊìç‰ΩúÊåâÈíÆ (ÈùûÂè™ËØªÊ®°ÂºèÊâçÊòæÁ§∫) -->
      <view wx:if="{{!readOnly}}" class="corner-actions">
        <view class="action-btn star-btn {{favStatus[prof.profId] ? 'favorited' : ''}}" data-id="{{prof.profId}}" data-index="{{idx}}" bindtap="onFavorite">
          <image class="action-icon" src="/assets/icons/star.svg" mode="aspectFit"/>
        </view>
        <view class="action-btn share-btn" data-prof="{{prof}}" bindtap="onProfessorShare">
          <image class="action-icon" src="/assets/icons/share.svg" mode="aspectFit"/>
        </view>
      </view>

      <!-- ÊïôÊéàÂßìÂêçÂíåÂåπÈÖçÂ∫¶ -->
      <view class="prof-header {{readOnly ? 'read-only' : ''}}">
        <text class="prof-name">{{prof.name}}</text>
        <view class="match-score" wx:if="{{prof.score >= 0 || prof.displayScore >= 0}}">
          <text class="score-text">ÂåπÈÖçÂ∫¶{{prof.score !== undefined && prof.score !== null ? prof.score : prof.displayScore}}%</text>
        </view>
      </view>

      <!-- Â≠¶Èô¢‰ø°ÊÅØ -->
      <view class="prof-school">{{prof.school}}</view>

      <!-- üéØ Á†îÁ©∂Ê†áÁ≠æ (Êñ∞Â¢û) -->
      <view class="research-tags" wx:if="{{prof.tags && prof.tags.length}}">
        <block wx:for="{{prof.tags}}" wx:for-item="tag" wx:for-index="tagIdx" wx:key="tagIdx">
          <text class="tag-item">{{tag}}</text>
        </block>
      </view>

      <!-- Á†îÁ©∂È¢ÜÂüüÊ†áÁ≠æ (‰øùÁïôÂéüÊúâÁöÑareas) -->
      <view class="research-areas" wx:if="{{prof.areas && prof.areas.length}}">
        <block wx:for="{{prof.areas}}" wx:for-item="area" wx:for-index="areaIdx" wx:key="areaIdx">
          <text class="area-tag">{{area}}</text>
        </block>
      </view>

      <!-- ÈáçÁÇπ‰ø°ÊÅØÂ±ïÁ§∫ÔºàÂ∑≤‰øÆÊîπ‰∏∫FlexÊñ∞ÁªìÊûÑÔºâ -->
      <view class="highlights" wx:if="{{prof.highlights && prof.highlights.length}}">
        <block wx:for="{{prof.highlights}}" wx:for-item="highlight" wx:key="hlIdx">
          <view class="highlight-list-item">
            <text class="highlight-bullet">‚Ä¢ </text>
            <view class="highlight-content">
              <block wx:if="{{isMarkdown(highlight)}}">
                <towxml class="markdown-content" nodes="{{parseMarkdown(highlight)}}" />
              </block>
              <block wx:else>
                <text class="plain-text">{{highlight}}</text>
              </block>
            </view>
          </view>
        </block>
      </view>

      <!-- ËÅîÁ≥ªÊñπÂºè -->
      <view class="contact-info">
        <view class="contact-item" wx:if="{{prof.email}}">
          <text class="contact-label">ÈÇÆÁÆ±Ôºö</text>
          <text class="contact-value contact-link email-link" data-text="{{prof.email}}" bindtap="copyToClipboard">{{prof.email}}</text>
        </view>
        <view class="contact-item" wx:if="{{prof.office}}">
          <text class="contact-label">ÂäûÂÖ¨Âú∞ÁÇπÔºö</text>
          <text class="contact-value">{{prof.office}}</text>
        </view>
        <view class="contact-item" wx:if="{{prof.phone}}">
          <text class="contact-label">ËÅîÁ≥ªÁîµËØùÔºö</text>
          <text class="contact-value contact-link" data-text="{{prof.phone}}" bindtap="copyToClipboard">{{prof.phone}}</text>
        </view>
        <view class="contact-item" wx:if="{{prof.homepages && prof.homepages.length}}">
          <text class="contact-label">‰∏™‰∫∫‰∏ªÈ°µÔºö</text>
          <view class="homepage-list">
            <block wx:for="{{prof.homepages}}" wx:for-item="homepage" wx:for-index="hpIdx" wx:key="hpIdx">
              <text class="contact-value contact-link homepage-link" data-text="{{homepage}}" bindtap="copyToClipboard">‚Ä¢ ÁÇπÂáªËÆøÈóÆ‰∏ªÈ°µ{{hpIdx > 0 ? ' ' + (hpIdx + 1) : ''}}</text>
            </block>
          </view>
        </view>
        <view class="contact-item" wx:elif="{{prof.homepage}}">
          <text class="contact-label">‰∏ªÈ°µÔºö</text>
          <text class="contact-value contact-link homepage-link" data-text="{{prof.homepage}}" bindtap="copyToClipboard">ÁÇπÂáªËÆøÈóÆ‰∏ªÈ°µ</text>
        </view>
      </view>

      <!-- ÂàÜ‰∫´Âç°ÁâáCanvas (ÈöêËóèÁä∂ÊÄÅ) -->
      <view class="share-canvas-container" style="position: absolute; left: -9999rpx; width: 0; height: 0;">
        <canvas type="2d" canvas-id="shareCanvas{{idx}}" style="width: 600rpx; height: 800rpx;"></canvas>
      </view>
      
    </view> <!-- Ê≠£Á°ÆÈó≠Âêà: prof-card -->
  </block> <!-- Ê≠£Á°ÆÈó≠Âêà: ÈÅçÂéÜcandidatesÁöÑblock -->
</view> <!-- Ê≠£Á°ÆÈó≠Âêà: professor-list -->

<view wx:else class="empty-state">
  <text class="empty-text">ÊöÇÊó†Êé®ËçêÁªìÊûú</text>
</view>